<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>GPU vs TPU ROI â€“ Scenarios</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f3f4f6;
      color: #111827;
    }
    .app-root {
      max-width: 1024px;
      margin: 2rem auto;
      padding: 1.75rem 1.75rem 2rem;
      border-radius: 1.25rem;
      background: #ffffff;
      box-shadow: 0 20px 45px rgba(15, 23, 42, 0.08);
      border: 1px solid #e5e7eb;
    }
    h1 {
      margin: 0 0 0.35rem 0;
      font-size: 1.9rem;
    }
    .subtitle {
      opacity: 0.8;
      margin-bottom: 1rem;
      max-width: 40rem;
      font-size: 0.95rem;
    }
    .layout {
      display: grid;
      grid-template-columns: minmax(0, 1.6fr) minmax(0, 1.3fr);
      gap: 1.5rem;
      margin-top: 1rem;
    }
    .card {
      background: #ffffff;
      border-radius: 0.9rem;
      padding: 1rem 1.1rem;
      border: 1px solid #e5e7eb;
    }
    .card h2 {
      margin-top: 0;
      font-size: 0.9rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      opacity: 0.85;
    }
    .scenario-select {
      width: 100%;
      padding: 0.45rem 0.6rem;
      border-radius: 0.6rem;
      border: 1px solid #d1d5db;
      background: #ffffff;
      color: #111827;
      font-size: 0.85rem;
    }
    .scenario-tags {
      margin-top: 0.6rem;
      font-size: 0.78rem;
      opacity: 0.9;
    }
    .scenario-pill {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      padding: 0.2rem 0.6rem;
      border-radius: 999px;
      font-size: 0.7rem;
      margin-right: 0.35rem;
      margin-bottom: 0.2rem;
    }
    .gpu-pill {
      background: #ecfdf3;
      color: #166534;
      border: 1px solid #bbf7d0;
    }
    .tpu-pill {
      background: #eff6ff;
      color: #1d4ed8;
      border: 1px solid #bfdbfe;
    }
    .slider-row {
      margin-bottom: 0.85rem;
    }
    .slider-row label {
      display: flex;
      justify-content: space-between;
      font-size: 0.85rem;
      margin-bottom: 0.18rem;
    }
    input[type=range] {
      width: 100%;
    }
    .score-big {
      font-size: 2.6rem;
      font-weight: 600;
    }
    .score-label {
      font-size: 0.85rem;
      opacity: 0.82;
    }
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.25rem 0.6rem;
      border-radius: 999px;
      font-size: 0.75rem;
      background: #eff6ff;
      color: #1d4ed8;
    }
    .pill.red {
      background: #fef2f2;
      color: #b91c1c;
    }
    .bars {
      margin-top: 0.7rem;
    }
    .bar-row {
      display: flex;
      align-items: center;
      margin-bottom: 0.4rem;
      font-size: 0.8rem;
    }
    .bar-label {
      width: 155px;
      opacity: 0.9;
    }
    .bar-track {
      flex: 1;
      height: 10px;
      border-radius: 999px;
      background: #e5e7eb;
      overflow: hidden;
    }
    .bar-fill {
      height: 100%;
      border-radius: 999px;
      background: linear-gradient(90deg, #3b82f6, #22c55e);
      transition: width 0.22s ease-out;
    }
    .bar-value {
      width: 34px;
      text-align: right;
      font-variant-numeric: tabular-nums;
      margin-left: 0.4rem;
      opacity: 0.9;
    }
    .api-debug {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.75rem;
      margin-top: 0.9rem;
      background: #f9fafb;
      padding: 0.6rem;
      border-radius: 0.5rem;
      max-height: 220px;
      overflow: auto;
      border: 1px solid #e5e7eb;
    }
    .top-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 1rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }
    .link-btn {
      font-size: 0.8rem;
      padding: 0.35rem 0.7rem;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      color: #111827;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      background: #f9fafb;
    }
    .link-btn span {
      font-size: 1rem;
    }
    .rec-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.35rem 0.75rem;
      border-radius: 999px;
      font-size: 0.78rem;
      border: 1px solid transparent;
      margin-top: 0.3rem;
    }
    .rec-gpu {
      background: #ecfdf3;
      color: #166534;
      border-color: #bbf7d0;
    }
    .rec-tpu {
      background: #eff6ff;
      color: #1d4ed8;
      border-color: #bfdbfe;
    }
    .rec-neutral {
      background: #f9fafb;
      color: #4b5563;
      border-color: #e5e7eb;
    }
    .mode-toggle {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      font-size: 0.8rem;
    }
    .mode-select {
      padding: 0.2rem 0.45rem;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      font-size: 0.78rem;
    }
    .quant-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.5rem 0.9rem;
      margin-top: 0.7rem;
    }
    .quant-field {
      font-size: 0.78rem;
    }
    .quant-field label {
      display: block;
      margin-bottom: 0.2rem;
    }
    .quant-field input {
      width: 100%;
      padding: 0.25rem 0.4rem;
      border-radius: 0.45rem;
      border: 1px solid #d1d5db;
      font-size: 0.8rem;
    }
    @media (max-width: 900px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }
  </style>
</head>
<body>
  <div id="root" class="app-root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const FACTOR_META = [
      { key: "flex", label: "Deployment Flexibility" },
      { key: "eco", label: "Ecosystem / Frameworks" },
      { key: "training", label: "Training Throughput" },
      { key: "cost", label: "Cost Efficiency" },
      { key: "latency", label: "Inference Latency" },
      { key: "ops", label: "Operability / Integration" },
    ];

    const SCENARIOS = {
      edge: {
        name: "Edge AI / Factory / Robot (GPU)",
        values: { flex: 5, eco: 5, training: 3, cost: 3, latency: 5, ops: 5 },
        type: "gpu"
      },
      mixed: {
        name: "Mixed Workloads / Multi-modal (GPU)",
        values: { flex: 5, eco: 5, training: 4, cost: 4, latency: 5, ops: 5 },
        type: "gpu"
      },
      pytorch: {
        name: "PyTorch-First R&D Team (GPU)",
        values: { flex: 5, eco: 5, training: 3, cost: 4, latency: 5, ops: 4 },
        type: "gpu"
      },
      hardware: {
        name: "Custom Hardware Flexibility (GPU)",
        values: { flex: 5, eco: 4, training: 3, cost: 4, latency: 5, ops: 4 },
        type: "gpu"
      },
      llm50b: {
        name: "50B+ LLM Training (TPU Pod)",
        values: { flex: 2, eco: 3, training: 5, cost: 5, latency: 2, ops: 3 },
        type: "tpu"
      },
      gcp_native: {
        name: "All-in Google Cloud ML (TPU)",
        values: { flex: 2, eco: 3, training: 5, cost: 5, latency: 2, ops: 3 },
        type: "tpu"
      },
      jax_batch: {
        name: "High-batch JAX Vision/NLP (TPU)",
        values: { flex: 2, eco: 3, training: 5, cost: 4, latency: 2, ops: 3 },
        type: "tpu"
      },
      tpu70: {
        name: "TPU Pod Utilization >70% (TPU)",
        values: { flex: 2, eco: 3, training: 5, cost: 5, latency: 2, ops: 3 },
        type: "tpu"
      }
    };

    function computeRecommendation(scenarioKey, roiScore) {
      if (!scenarioKey || roiScore == null) {
        return {
          label: "Pick a scenario and adjust inputs to see a recommendation.",
          className: "rec-neutral",
        };
      }
      const scenario = SCENARIOS[scenarioKey];
      if (!scenario) {
        return {
          label: "Tune your inputs to refine the recommendation.",
          className: "rec-neutral",
        };
      }
      const strong = roiScore >= 3.8;
      const medium = roiScore >= 3.2;

      if (scenario.type === "gpu") {
        if (strong) {
          return { label: "Recommended: GPU for this scenario.", className: "rec-gpu" };
        } else if (medium) {
          return { label: "Likely GPU, but validate with cost / utilization.", className: "rec-gpu" };
        }
        return { label: "GPU-leaning scenario, but ROI is weak â€” revisit assumptions.", className: "rec-neutral" };
      }

      if (scenario.type === "tpu") {
        if (strong) {
          return { label: "Recommended: TPU for this scenario.", className: "rec-tpu" };
        } else if (medium) {
          return { label: "Likely TPU, but validate Pod utilization and GCP lock-in.", className: "rec-tpu" };
        }
        return { label: "TPU-leaning scenario, but ROI is weak â€” revisit assumptions.", className: "rec-neutral" };
      }

      return {
        label: "Tune your inputs to refine the recommendation.",
        className: "rec-neutral",
      };
    }

    function RoiApp() {
      const [factors, setFactors] = React.useState({
        flex: 5,
        eco: 5,
        training: 4,
        cost: 4,
        latency: 5,
        ops: 5,
      });
      const [quant, setQuant] = React.useState({
        workload_fit: 3,
        deployment_fit: 3,
        p99_latency_ms: 50,
        target_latency_ms: 50,
        cost_per_unit: 0.000000002,
        best_cost_per_unit: 0.0000000015,
        energy_per_unit: 0.000000002,
        best_energy_per_unit: 0.0000000015,
      });
      const [mode, setMode] = React.useState("simple");
      const [roi, setRoi] = React.useState(null);
      const [loading, setLoading] = React.useState(false);
      const [error, setError] = React.useState(null);
      const [scenarioKey, setScenarioKey] = React.useState("");

      const updateFactor = (key, value) => {
        setFactors(prev => ({ ...prev, [key]: Number(value) }));
      };

      const updateQuant = (key, value) => {
        const num = Number(value);
        setQuant(prev => ({ ...prev, [key]: isNaN(num) ? prev[key] : num }));
      };

      const applyScenario = (key) => {
        setScenarioKey(key);
        const preset = SCENARIOS[key]?.values;
        if (preset) {
          setFactors(preset);
        }
      };

      React.useEffect(() => {
        const params = new URLSearchParams({
          mode,
          ...Object.fromEntries(Object.entries(factors).map(([k, v]) => [k, String(v)])),
          ...Object.fromEntries(Object.entries(quant).map(([k, v]) => [k, String(v)])),
        }).toString();
        setLoading(true);
        setError(null);
        fetch("/api/roi?" + params)
          .then(r => r.json())
          .then(data => setRoi(data))
          .catch(err => {
            console.error(err);
            setError("Failed to reach /api/roi");
          })
          .finally(() => setLoading(false));
      }, [JSON.stringify(factors), JSON.stringify(quant), mode]);

      const roiScore = roi ? roi.roi_score : null;
      const confidence =
        roiScore == null ? "â€“" :
        roiScore >= 4.5 ? "Very strong ROI" :
        roiScore >= 3.7 ? "Good ROI" :
        roiScore >= 3.0 ? "Moderate ROI" :
        "Weak ROI";

      const rec = computeRecommendation(scenarioKey, roiScore);

      return (
        <>
          <div className="top-row">
            <div>
              <h1>GPU vs TPU â€“ Scenario-based ROI</h1>
              <p className="subtitle">
                Choose a scenario (edge, mixed workloads, TPU Pods, GCP-native), then either use the
                simple sliders or switch to quantitative mode with measured latency, cost, and energy.
              </p>
              <div className={"rec-badge " + rec.className}>
                <span>âœ…</span>
                <span>{rec.label}</span>
              </div>
            </div>
            <div style={{ display: "flex", flexDirection: "column", alignItems: "flex-end", gap: "0.4rem" }}>
              <a className="link-btn" href="/docs">
                <span>ðŸ“„</span> Docs
              </a>
              <div className="mode-toggle">
                <span>Mode:</span>
                <select
                  className="mode-select"
                  value={mode}
                  onChange={(e) => setMode(e.target.value)}
                >
                  <option value="simple">Simple (0â€“5 sliders)</option>
                  <option value="quant">Quantitative (measured)</option>
                </select>
              </div>
            </div>
          </div>

          <div className="layout">
            <div>
              <div className="card" style={{ marginBottom: "1rem" }}>
                <h2>Scenario</h2>
                <select
                  className="scenario-select"
                  value={scenarioKey}
                  onChange={(e) => applyScenario(e.target.value)}
                >
                  <option value="">â€” Select a scenario â€”</option>
                  <optgroup label="GPU-leaning">
                    <option value="edge">Edge AI / Factory / Robot (GPU)</option>
                    <option value="mixed">Mixed Workloads / Multi-modal (GPU)</option>
                    <option value="pytorch">PyTorch-First R&D Team (GPU)</option>
                    <option value="hardware">Custom Hardware Flexibility (GPU)</option>
                  </optgroup>
                  <optgroup label="TPU-leaning">
                    <option value="llm50b">50B+ LLM Training (TPU Pod)</option>
                    <option value="gcp_native">All-in Google Cloud ML (TPU)</option>
                    <option value="jax_batch">High-batch JAX Vision/NLP (TPU)</option>
                    <option value="tpu70">TPU Pod Utilization >70% (TPU)</option>
                  </optgroup>
                </select>
                <div className="scenario-tags">
                  {scenarioKey && SCENARIOS[scenarioKey]?.type === "gpu" && (
                    <span className="scenario-pill gpu-pill">GPU-centric scenario</span>
                  )}
                  {scenarioKey && SCENARIOS[scenarioKey]?.type === "tpu" && (
                    <span className="scenario-pill tpu-pill">TPU-centric scenario</span>
                  )}
                </div>
              </div>

              <div className="card">
                <h2>Inputs Â· Simple Factors (0â€“5)</h2>
                {FACTOR_META.map(meta => (
                  <div key={meta.key} className="slider-row">
                    <label>
                      <span>{meta.label}</span>
                      <span>{factors[meta.key].toFixed(1)}</span>
                    </label>
                    <input
                      type="range"
                      min="0"
                      max="5"
                      step="0.5"
                      value={factors[meta.key]}
                      onChange={e => updateFactor(meta.key, e.target.value)}
                    />
                  </div>
                ))}
                <p style={{ fontSize: "0.75rem", opacity: 0.8, marginTop: "0.4rem" }}>
                  Simple mode uses only these sliders. Quantitative mode combines measured metrics with
                  workload/deployment fit.
                </p>
              </div>

              {mode === "quant" && (
                <div className="card" style={{ marginTop: "1rem" }}>
                  <h2>Inputs Â· Quantitative (measured)</h2>
                  <div className="quant-grid">
                    <div className="quant-field">
                      <label>Workload fit (0â€“5)</label>
                      <input
                        type="number"
                        min="0"
                        max="5"
                        step="0.1"
                        value={quant.workload_fit}
                        onChange={e => updateQuant("workload_fit", e.target.value)}
                      />
                    </div>
                    <div className="quant-field">
                      <label>Deployment fit (0â€“5)</label>
                      <input
                        type="number"
                        min="0"
                        max="5"
                        step="0.1"
                        value={quant.deployment_fit}
                        onChange={e => updateQuant("deployment_fit", e.target.value)}
                      />
                    </div>
                    <div className="quant-field">
                      <label>p99 latency (ms)</label>
                      <input
                        type="number"
                        min="0.001"
                        step="0.1"
                        value={quant.p99_latency_ms}
                        onChange={e => updateQuant("p99_latency_ms", e.target.value)}
                      />
                    </div>
                    <div className="quant-field">
                      <label>Target p99 latency (ms)</label>
                      <input
                        type="number"
                        min="0.001"
                        step="0.1"
                        value={quant.target_latency_ms}
                        onChange={e => updateQuant("target_latency_ms", e.target.value)}
                      />
                    </div>
                    <div className="quant-field">
                      <label>Cost per unit (e.g. $/token)</label>
                      <input
                        type="number"
                        min="0.000000000000001"
                        step="0.000000000000001"
                        value={quant.cost_per_unit}
                        onChange={e => updateQuant("cost_per_unit", e.target.value)}
                      />
                    </div>
                    <div className="quant-field">
                      <label>Best cost per unit</label>
                      <input
                        type="number"
                        min="0.000000000000001"
                        step="0.000000000000001"
                        value={quant.best_cost_per_unit}
                        onChange={e => updateQuant("best_cost_per_unit", e.target.value)}
                      />
                    </div>
                    <div className="quant-field">
                      <label>Energy per unit (kWh)</label>
                      <input
                        type="number"
                        min="0.000000000000001"
                        step="0.000000000000001"
                        value={quant.energy_per_unit}
                        onChange={e => updateQuant("energy_per_unit", e.target.value)}
                      />
                    </div>
                    <div className="quant-field">
                      <label>Best energy per unit</label>
                      <input
                        type="number"
                        min="0.000000000000001"
                        step="0.000000000000001"
                        value={quant.best_energy_per_unit}
                        onChange={e => updateQuant("best_energy_per_unit", e.target.value)}
                      />
                    </div>
                  </div>
                  <p style={{ fontSize: "0.75rem", opacity: 0.8, marginTop: "0.4rem" }}>
                    Use these fields when you have real measurements from benchmarks. The backend computes
                    normalized scores for latency, cost, and sustainability and combines them with workload/
                    deployment fit into a 0â€“5 ROI score.
                  </p>
                </div>
              )}
            </div>

            <div className="card">
              <div style={{ display: "flex", justifyContent: "space-between", alignItems: "baseline" }}>
                <h2>Output Â· ROI Score</h2>
                <span style={{ fontSize: "0.75rem", opacity: 0.75 }}>
                  {mode === "simple" ? "Using simple weights" : "Using quantitative weights"}
                </span>
              </div>
              <div style={{ display: "flex", alignItems: "baseline", gap: "0.75rem" }}>
                <div className="score-big">
                  {roiScore != null ? roiScore.toFixed(2) : "â€“"}
                </div>
                <div className="score-label">
                  Overall ROI score<br />normalized to 0â€“5
                </div>
              </div>
              <div style={{ marginTop: "0.6rem" }}>
                <span className={"pill " + (roiScore != null && roiScore < 3 ? "red" : "")}>
                  {loading ? "Recomputing..." : confidence}
                </span>
              </div>

              <div className="bars">
                {FACTOR_META.map(meta => (
                  <div key={meta.key} className="bar-row">
                    <div className="bar-label">{meta.label}</div>
                    <div className="bar-track">
                      <div
                        className="bar-fill"
                        style={{ width: `${(factors[meta.key] / 5) * 100}%` }}
                      />
                    </div>
                    <div className="bar-value">{factors[meta.key].toFixed(1)}</div>
                  </div>
                ))}
              </div>

              <div className="api-debug">
                <strong>API payload</strong><br />
                {error && <div style={{ color: "#b91c1c" }}>Error: {error}</div>}
                {!error && (
                  <pre style={{ marginTop: "0.25rem" }}>{`GET /api/roi?mode=${mode}&flex=${factors.flex}&eco=${factors.eco}&training=${factors.training}&cost=${factors.cost}&latency=${factors.latency}&ops=${factors.ops}
&workload_fit=${quant.workload_fit}&deployment_fit=${quant.deployment_fit}&p99_latency_ms=${quant.p99_latency_ms}&target_latency_ms=${quant.target_latency_ms}
&cost_per_unit=${quant.cost_per_unit}&best_cost_per_unit=${quant.best_cost_per_unit}
&energy_per_unit=${quant.energy_per_unit}&best_energy_per_unit=${quant.best_energy_per_unit}

${roi ? JSON.stringify(roi, null, 2) : "// waiting for response..."}`}</pre>
                )}
              </div>
            </div>
          </div>
        </>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<RoiApp />);
  </script>
</body>
</html>
