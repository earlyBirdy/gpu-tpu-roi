<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>GPU vs TPU ROI – Interactive UI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- React + ReactDOM + Babel from CDN -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #020617;
      color: #e5e7eb;
    }
    .app-root {
      max-width: 1100px;
      margin: 2rem auto;
      padding: 1.5rem;
      border-radius: 1.25rem;
      background: radial-gradient(circle at top left, #1d4ed8, #020617 50%);
      box-shadow: 0 24px 60px rgba(0,0,0,0.6);
    }
    h1 {
      margin-top: 0;
      font-size: 1.8rem;
    }
    .subtitle {
      opacity: 0.8;
      margin-bottom: 1.5rem;
    }
    .grid {
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 1.3fr);
      gap: 1.5rem;
    }
    .card {
      background: rgba(15,23,42,0.9);
      border-radius: 1rem;
      padding: 1rem 1.25rem;
      border: 1px solid rgba(148,163,184,0.25);
      backdrop-filter: blur(10px);
    }
    .slider-row {
      margin-bottom: 0.85rem;
    }
    .slider-row label {
      display: flex;
      justify-content: space-between;
      font-size: 0.85rem;
      margin-bottom: 0.15rem;
    }
    input[type=range] {
      width: 100%;
    }
    .score-big {
      font-size: 2.4rem;
      font-weight: 600;
    }
    .score-label {
      font-size: 0.85rem;
      opacity: 0.8;
    }
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.25rem 0.6rem;
      border-radius: 999px;
      font-size: 0.75rem;
      background: rgba(56,189,248,0.1);
      color: #7dd3fc;
    }
    .pill.red {
      background: rgba(248,113,113,0.12);
      color: #fecaca;
    }
    .bars {
      margin-top: 0.5rem;
    }
    .bar-row {
      display: flex;
      align-items: center;
      margin-bottom: 0.35rem;
      font-size: 0.8rem;
    }
    .bar-label {
      width: 160px;
      opacity: 0.85;
    }
    .bar-track {
      flex: 1;
      height: 10px;
      border-radius: 999px;
      background: rgba(148,163,184,0.2);
      overflow: hidden;
    }
    .bar-fill {
      height: 100%;
      border-radius: 999px;
      background: linear-gradient(90deg, #38bdf8, #22c55e);
      transition: width 0.25s ease-out;
    }
    .bar-value {
      width: 34px;
      text-align: right;
      font-variant-numeric: tabular-nums;
      margin-left: 0.4rem;
      opacity: 0.85;
    }
    .api-debug {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.75rem;
      margin-top: 0.75rem;
      background: rgba(15,23,42,0.9);
      padding: 0.6rem;
      border-radius: 0.5rem;
      max-height: 180px;
      overflow: auto;
      border: 1px solid rgba(148,163,184,0.2);
    }
    .top-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }
    .link-btn {
      font-size: 0.8rem;
      padding: 0.35rem 0.7rem;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.4);
      color: #e5e7eb;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      background: rgba(15,23,42,0.7);
    }
    .link-btn span {
      font-size: 1rem;
    }
    .explain {
      margin-top: 1rem;
      font-size: 0.8rem;
      opacity: 0.9;
    }
    .explain h3 {
      font-size: 0.9rem;
      margin-bottom: 0.25rem;
    }
    .explain p {
      margin: 0.1rem 0;
    }
    @media (max-width: 900px) {
      .grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }
  </style>
</head>
<body>
  <div id="root" class="app-root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const FACTOR_META = [
      { key: "flex", label: "Deployment Flexibility" },
      { key: "eco", label: "Ecosystem / Frameworks" },
      { key: "training", label: "Training Throughput" },
      { key: "cost", label: "Cost Efficiency" },
      { key: "latency", label: "Inference Latency" },
      { key: "ops", label: "Operability / Integration" },
    ];

    function RoiApp() {
      const [factors, setFactors] = useState({
        flex: 5,
        eco: 5,
        training: 4,
        cost: 4,
        latency: 5,
        ops: 5,
      });
      const [roi, setRoi] = useState(null);
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState(null);

      const updateFactor = (key, value) => {
        setFactors(prev => ({ ...prev, [key]: Number(value) }));
      };

      useEffect(() => {
        const params = new URLSearchParams(factors).toString();
        setLoading(true);
        setError(null);
        fetch("/api/roi?" + params)
          .then(r => r.json())
          .then(data => setRoi(data))
          .catch(err => {
            console.error(err);
            setError("Failed to reach /api/roi");
          })
          .finally(() => setLoading(false));
      }, [JSON.stringify(factors)]);

      const roiScore = roi ? roi.roi_score : null;
      const confidence =
        roiScore == null ? "–" :
        roiScore >= 4.5 ? "Very strong ROI" :
        roiScore >= 3.7 ? "Good ROI" :
        roiScore >= 3.0 ? "Moderate ROI" :
        "Weak ROI";

      return (
        <>
          <h1>GPU vs TPU – ROI Calculator</h1>
          <p className="subtitle">
            Move the sliders to describe your workload. The backend FastAPI API combines
            your ratings using fixed ROI weights and returns a normalized score (0–5).
          </p>

          <div className="top-actions">
            <div className="pill">
              <span>⚙️</span>
              Live from <code>/api/roi</code>
            </div>
            <div>
              <a className="link-btn" href="https://www.nvidia.com" target="_blank" rel="noreferrer">
                GPU ecosystem
              </a>
              <a className="link-btn" href="https://cloud.google.com/tpu" target="_blank" rel="noreferrer">
                TPU overview
              </a>
            </div>
          </div>

          <div className="grid">
            <div className="card">
              <h2 style={{ marginTop: 0, fontSize: "1rem" }}>Inputs · Factors (0–5)</h2>
              {FACTOR_META.map(meta => (
                <div key={meta.key} className="slider-row">
                  <label>
                    <span>{meta.label}</span>
                    <span>{factors[meta.key].toFixed(1)}</span>
                  </label>
                  <input
                    type="range"
                    min="0"
                    max="5"
                    step="0.5"
                    value={factors[meta.key]}
                    onChange={e => updateFactor(meta.key, e.target.value)}
                  />
                </div>
              ))}
            </div>

            <div className="card">
              <h2 style={{ marginTop: 0, fontSize: "1rem" }}>Output · ROI Score</h2>
              <div style={{ display: "flex", alignItems: "baseline", gap: "0.75rem" }}>
                <div className="score-big">
                  {roiScore != null ? roiScore.toFixed(2) : "–"}
                </div>
                <div className="score-label">
                  Overall ROI score<br />normalized to 0–5
                </div>
              </div>
              <div style={{ marginTop: "0.6rem" }}>
                <span className={"pill " + (roiScore != null && roiScore < 3 ? "red" : "")}>
                  {loading ? "Recomputing..." : confidence}
                </span>
              </div>

              <div className="bars">
                {FACTOR_META.map(meta => (
                  <div key={meta.key} className="bar-row">
                    <div className="bar-label">{meta.label}</div>
                    <div className="bar-track">
                      <div
                        className="bar-fill"
                        style={{ width: `${(factors[meta.key] / 5) * 100}%` }}
                      />
                    </div>
                    <div className="bar-value">{factors[meta.key].toFixed(1)}</div>
                  </div>
                ))}
              </div>

              <div className="api-debug">
                <strong>API payload</strong><br />
                {error && <div style={{ color: "#fecaca" }}>Error: {error}</div>}
                {!error && (
                  <pre style={{ marginTop: "0.25rem" }}>
{`GET /api/roi?flex=${factors.flex}&eco=${factors.eco}&training=${factors.training}&cost=${factors.cost}&latency=${factors.latency}&ops=${factors.ops}

${roi ? JSON.stringify(roi, null, 2) : "// waiting for response..."}`}
                  </pre>
                )}
              </div>
            </div>
          </div>

          <div className="card explain">
            <h3>How to read this</h3>
            <p><strong>GPU tends to win</strong> when you care about: edge deployments, mixed workloads, PyTorch-first ecosystem, and hardware choice.</p>
            <p><strong>TPU tends to win</strong> when you run very large JAX / TensorFlow training jobs entirely on Google Cloud and can keep TPU Pods busy.</p>
            <p>Use this tool as a quick, opinionated view — not as a replacement for a detailed TCO model.</p>
          </div>
        </>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<RoiApp />);
  </script>
</body>
</html>
